<Window x:Class="ScrapSAE.Desktop.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ScrapSAE.Desktop.Infrastructure"
        mc:Ignorable="d"
        Title="ScrapSAE - Consola"
        Height="900"
        Width="1300"
        WindowStartupLocation="CenterScreen"
        Loaded="MainWindow_OnLoaded">
    <Grid Background="#F3F5F8">
        <Grid.Resources>
            <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
            <local:NegateBooleanConverter x:Key="NegateBool" />
            <Style TargetType="Button">
                <Setter Property="Padding" Value="12,8" />
                <Setter Property="Margin" Value="0,0,8,0" />
                <Setter Property="Background" Value="#2563EB" />
                <Setter Property="Foreground" Value="White" />
                <Setter Property="BorderBrush" Value="#1D4ED8" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Cursor" Value="Hand" />
                <Setter Property="FontWeight" Value="Medium" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="6"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Opacity" Value="0.9" />
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Opacity" Value="0.8" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style TargetType="TextBox">
                <Setter Property="Margin" Value="0,6,0,12" />
                <Setter Property="Padding" Value="10" />
                <Setter Property="BorderBrush" Value="#D1D5DB" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Background" Value="White" />
                <Setter Property="FontSize" Value="13" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TextBox">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="4">
                                <ScrollViewer x:Name="PART_ContentHost" Margin="{TemplateBinding Padding}" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style TargetType="DataGrid">
                <Setter Property="RowBackground" Value="White" />
                <Setter Property="AlternatingRowBackground" Value="#F9FAFB" />
                <Setter Property="GridLinesVisibility" Value="Horizontal" />
                <Setter Property="BorderBrush" Value="#E5E7EB" />
                <Setter Property="BorderThickness" Value="1" />
            </Style>
            <Style TargetType="TabControl">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="BorderThickness" Value="0" />
            </Style>
            <Style TargetType="TabItem">
                <Setter Property="Padding" Value="12,6" />
                <Setter Property="Margin" Value="0,0,2,0" />
            </Style>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Border Background="#111827" Padding="20">
            <DockPanel>
                <StackPanel Orientation="Horizontal">
                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8B7;" Foreground="#3B82F6" FontSize="28" Margin="0,0,12,0" VerticalAlignment="Center" />
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="ScrapSAE Console" Foreground="White" FontSize="22" FontWeight="Bold" />
                        <TextBlock Text="Sistema de Scraping Automatizado" Foreground="#9CA3AF" FontSize="11" Margin="0,2,0,0" />
                    </StackPanel>
                </StackPanel>
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                    <Border Background="#1F2937" CornerRadius="4" Padding="8,4" Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE81C;" Foreground="#10B981" FontSize="14" Margin="0,0,6,0" VerticalAlignment="Center" />
                            <TextBlock Text="{Binding Sites.Count}" Foreground="White" FontWeight="SemiBold" VerticalAlignment="Center" />
                            <TextBlock Text=" proveedores" Foreground="#9CA3AF" FontSize="11" VerticalAlignment="Center" Margin="2,0,0,0" />
                        </StackPanel>
                    </Border>
                    <Button Content="Refrescar"
                            Command="{Binding LoadAllCommand}"
                            Background="#F59E0B"
                            BorderBrush="#D97706" />
                </StackPanel>
            </DockPanel>
        </Border>

        <Border Grid.Row="1" Background="#F9FAFB" Padding="12" BorderBrush="#E5E7EB" BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal">
                <Button Click="Nav_Click" Tag="0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE1DB;" Margin="0,0,6,0" />
                        <TextBlock Text="Health" />
                    </StackPanel>
                </Button>
                <Button Click="Nav_Click" Tag="1">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE115;" Margin="0,0,6,0" />
                        <TextBlock Text="Configuración" />
                    </StackPanel>
                </Button>
                <Button Click="Nav_Click" Tag="2">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE13D;" Margin="0,0,6,0" />
                        <TextBlock Text="Proveedores" />
                    </StackPanel>
                </Button>
                <Button Click="Nav_Click" Tag="3">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE1CF;" Margin="0,0,6,0" />
                        <TextBlock Text="Staging" />
                    </StackPanel>
                </Button>
                <Button Click="Nav_Click" Tag="4">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE158;" Margin="0,0,6,0" />
                        <TextBlock Text="Mapeo" />
                    </StackPanel>
                </Button>
                <Button Click="Nav_Click" Tag="5">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE133;" Margin="0,0,6,0" />
                        <TextBlock Text="Logs" />
                    </StackPanel>
                </Button>
                <Button Click="Nav_Click" Tag="6">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE125;" Margin="0,0,6,0" />
                        <TextBlock Text="App Logs" />
                    </StackPanel>
                </Button>
                <Button Click="Nav_Click" Tag="7">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE12A;" Margin="0,0,6,0" />
                        <TextBlock Text="Reportes" />
                    </StackPanel>
                </Button>
                <Button Click="Nav_Click" Tag="8">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE135;" Margin="0,0,6,0" />
                        <TextBlock Text="Scraping" />
                    </StackPanel>
                </Button>
                <Button Click="Nav_Click" Tag="9">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE126;" Margin="0,0,6,0" />
                        <TextBlock Text="SAE" />
                    </StackPanel>
                </Button>
                <Button Command="{Binding ExitCommand}" Background="#EF4444" BorderBrush="#B91C1C" Margin="12,0,0,0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE117;" Margin="0,0,6,0" />
                        <TextBlock Text="Salir" />
                    </StackPanel>
                </Button>
            </StackPanel>
        </Border>

        <TabControl Grid.Row="2" Margin="16" SelectedIndex="{Binding SelectedTabIndex}">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="Visibility" Value="Collapsed" />
                    <Setter Property="Height" Value="0" />
                    <Setter Property="Width" Value="0" />
                </Style>
            </TabControl.Resources>
            <TabItem Header="Health">
                <Grid Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <Button Content="Probar Backend" Command="{Binding TestBackendCommand}" Margin="0,0,8,0" />
                        <Button Content="Ejecutar Diagnóstico" Command="{Binding RunDiagnosticsCommand}" />
                    </StackPanel>
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Border Grid.Column="0" Background="White" Padding="12" Margin="0,0,8,0" CornerRadius="6" BorderBrush="#E5E7EB" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Estado Backend" FontWeight="SemiBold" />
                                <TextBlock Text="{Binding BackendStatus}" FontSize="16" />
                                <TextBlock Text="Supabase" FontWeight="SemiBold" Margin="0,12,0,0" />
                                <TextBlock Text="{Binding SupabaseStatus}" FontSize="16" />
                                <TextBlock Text="SAE SDK" FontWeight="SemiBold" Margin="0,12,0,0" />
                                <TextBlock Text="{Binding SaeStatus}" FontSize="16" />
                                <TextBlock Text="Base de datos" FontWeight="SemiBold" Margin="0,12,0,0" />
                                <TextBlock Text="{Binding DatabaseStatus}" FontSize="16" />
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="1" Background="White" Padding="12" Margin="8,0,0,0" CornerRadius="6" BorderBrush="#E5E7EB" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Detalles" FontWeight="SemiBold" />
                                <TextBlock Text="{Binding DiagnosticsResult.SupabaseMessage}" TextWrapping="Wrap" Margin="0,8,0,0" />
                                <TextBlock Text="{Binding DiagnosticsResult.SaeMessage}" TextWrapping="Wrap" Margin="0,8,0,0" />
                                <TextBlock Text="Última verificación (UTC)" FontWeight="SemiBold" Margin="0,12,0,0" />
                                <TextBlock Text="{Binding DiagnosticsResult.CheckedAtUtc}" />
                            </StackPanel>
                        </Border>
                    </Grid>
                </Grid>
            </TabItem>

            <TabItem Header="Configuración">
                <Grid Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <Button Content="Cargar" Command="{Binding LoadSettingsCommand}" Margin="0,0,8,0" />
                        <Button Content="Guardar" Command="{Binding SaveSettingsCommand}" Margin="0,0,8,0" />
                        <Button Content="Diagnóstico" Command="{Binding RunDiagnosticsCommand}" />
                    </StackPanel>
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Border Grid.Column="0" Background="White" Padding="12" Margin="0,0,8,0" CornerRadius="6" BorderBrush="#E5E7EB" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Supabase URL" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SupabaseUrl}" />
                                <TextBlock Text="Supabase Service Key" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SupabaseServiceKey}" />
                                <TextBlock Text="SAE SDK Path" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SaeSdkPath}" />
                                <TextBlock Text="SAE DB Host" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SaeDbHost}" />
                                <TextBlock Text="SAE DB Path (FDB)" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SaeDbPath}" AutomationProperties.AutomationId="SaeDbPath" AutomationProperties.Name="SaeDbPath" />
                                <TextBlock Text="SAE DB Port" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SaeDbPort}" />
                                <TextBlock Text="SAE DB Charset" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SaeDbCharset}" />
                                <TextBlock Text="SAE DB Dialect" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SaeDbDialect}" />
                                <TextBlock Text="SAE Default Line Code" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SaeDefaultLineCode}" />
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="1" Background="White" Padding="12" Margin="8,0,0,0" CornerRadius="6" BorderBrush="#E5E7EB" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Usuario SAE" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SaeUser}" />
                                <TextBlock Text="Password SAE" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SaePassword}" />
                                <TextBlock Text="Usuario DB" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SaeDbUser}" />
                                <TextBlock Text="Password DB" FontWeight="SemiBold" />
                                <TextBox Text="{Binding SaeDbPassword}" />
                                <TextBlock Text="Nota" FontWeight="SemiBold" Margin="0,12,0,0" />
                                <TextBlock Text="Guarda la configuración y reinicia el backend para aplicar cambios." TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>
                    </Grid>
                </Grid>
            </TabItem>
            <TabItem Header="Proveedores">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="Crear" Command="{Binding CreateSiteCommand}" Margin="0,0,8,0" />
                        <Button Content="Actualizar" Command="{Binding UpdateSiteCommand}" Margin="0,0,8,0" />
                        <Button Content="Eliminar" Command="{Binding DeleteSiteCommand}" />
                    </StackPanel>
                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding Sites}"
                              SelectedItem="{Binding SelectedSite}"
                              AutoGenerateColumns="True"
                              IsReadOnly="False"
                              CanUserAddRows="False"
                              Margin="0,4,0,0" />
                </Grid>
            </TabItem>

            <TabItem Header="Staging Productos">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="Crear" Command="{Binding CreateStagingCommand}" Margin="0,0,8,0" />
                        <Button Content="Actualizar" Command="{Binding UpdateStagingCommand}" Margin="0,0,8,0" />
                        <Button Content="Eliminar" Command="{Binding DeleteStagingCommand}" />
                    </StackPanel>
                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding StagingProducts}"
                              SelectedItem="{Binding SelectedStagingProduct}"
                              AutoGenerateColumns="True"
                              IsReadOnly="False"
                              CanUserAddRows="False"
                              Margin="0,4,0,0" />
                </Grid>
            </TabItem>

            <TabItem Header="Mapeo Categorías">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="Crear" Command="{Binding CreateCategoryCommand}" Margin="0,0,8,0" />
                        <Button Content="Actualizar" Command="{Binding UpdateCategoryCommand}" Margin="0,0,8,0" />
                        <Button Content="Eliminar" Command="{Binding DeleteCategoryCommand}" />
                    </StackPanel>
                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding CategoryMappings}"
                              SelectedItem="{Binding SelectedCategoryMapping}"
                              AutoGenerateColumns="True"
                              IsReadOnly="False"
                              CanUserAddRows="False"
                              Margin="0,4,0,0" />
                </Grid>
            </TabItem>

            <TabItem Header="Logs">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="Crear" Command="{Binding CreateSyncLogCommand}" Margin="0,0,8,0" />
                        <Button Content="Actualizar" Command="{Binding UpdateSyncLogCommand}" Margin="0,0,8,0" />
                        <Button Content="Eliminar" Command="{Binding DeleteSyncLogCommand}" />
                    </StackPanel>
                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding SyncLogs}"
                              SelectedItem="{Binding SelectedSyncLog}"
                              AutoGenerateColumns="True"
                              IsReadOnly="False"
                              CanUserAddRows="False"
                              Margin="0,4,0,0" />
                </Grid>
            </TabItem>
            <TabItem Header="App Logs">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="Refrescar" Command="{Binding RefreshAppLogsCommand}" />
                        <TextBlock Text="Archivo:" Margin="8,0,4,0" VerticalAlignment="Center" />
                        <TextBlock Text="{Binding AppLogPath}" VerticalAlignment="Center" />
                    </StackPanel>
                    <ListBox Grid.Row="1"
                             ItemsSource="{Binding AppLogs}"
                             FontFamily="Consolas"
                             FontSize="12"
                             Background="White"
                             BorderBrush="#E5E7EB"
                             BorderThickness="1" />
                </Grid>
            </TabItem>

            <TabItem Header="Reportes">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="Crear" Command="{Binding CreateReportCommand}" Margin="0,0,8,0" />
                        <Button Content="Actualizar" Command="{Binding UpdateReportCommand}" Margin="0,0,8,0" />
                        <Button Content="Eliminar" Command="{Binding DeleteReportCommand}" />
                    </StackPanel>
                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding ExecutionReports}"
                              SelectedItem="{Binding SelectedExecutionReport}"
                              AutoGenerateColumns="True"
                              IsReadOnly="False"
                              CanUserAddRows="False"
                              Margin="0,4,0,0" />
                </Grid>
            </TabItem>

            <TabItem Header="Scraping">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    
                    <!-- Barra de herramientas principal -->
                    <Border Background="White" Padding="12" CornerRadius="6" BorderBrush="#E5E7EB" BorderThickness="1" Margin="0,0,0,12">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Proveedor:" VerticalAlignment="Center" Margin="0,0,8,0" FontWeight="SemiBold" />
                                <ComboBox ItemsSource="{Binding Sites}"
                                          SelectedItem="{Binding SelectedSite}"
                                          DisplayMemberPath="Name"
                                          Width="260"
                                          Margin="0,0,12,0" />
                                <TextBlock Text="Cargados:" VerticalAlignment="Center" Margin="0,0,6,0" />
                                <TextBlock Text="{Binding Sites.Count}" VerticalAlignment="Center" Margin="0,0,12,0" FontWeight="Bold" />
                                <Button Content="Iniciar" Command="{Binding RunScrapingCommand}" Background="#10B981" BorderBrush="#059669" />
                                <Button Content="Pausar" Command="{Binding PauseScrapingCommand}" Background="#F59E0B" BorderBrush="#D97706" />
                                <Button Content="Reanudar" Command="{Binding ResumeScrapingCommand}" Background="#3B82F6" BorderBrush="#2563EB" />
                                <Button Content="Detener" Command="{Binding StopScrapingCommand}" Background="#EF4444" BorderBrush="#DC2626" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="Refrescar logs" Command="{Binding RefreshLogsCommand}" Margin="0,0,8,0" />
                                <Button Content="Analizar selectores (IA)" Command="{Binding AnalyzeSelectorsCommand}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Configuración de modo de scraping -->
                    <Border Grid.Row="1" Background="#F3F4F6" Padding="12" CornerRadius="6" BorderBrush="#D1D5DB" BorderThickness="1" Margin="0,0,0,12">
                        <StackPanel>
                            <TextBlock Text="Configuración de Scraping" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,8" />
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <CheckBox Content="Login manual" IsChecked="{Binding ManualLoginEnabled}" Margin="0,0,16,0" />
                                <CheckBox Content="Headless" IsChecked="{Binding HeadlessEnabled}" IsEnabled="{Binding ManualLoginEnabled, Converter={StaticResource NegateBool}}" Margin="0,0,16,0" />
                                <TextBlock Text="Modo:" VerticalAlignment="Center" Margin="0,0,8,0" FontWeight="SemiBold" />
                                <ComboBox SelectedValue="{Binding ScrapingMode}" SelectedValuePath="Content" Width="150" Margin="0,0,16,0">
                                    <ComboBoxItem Content="Tradicional" />
                                    <ComboBoxItem Content="Familias (Festo)" />
                                </ComboBox>
                                <TextBlock Text="Estado:" VerticalAlignment="Center" Margin="0,0,6,0" />
                                <TextBlock Text="{Binding ScrapeStatusText}" VerticalAlignment="Center" FontWeight="Bold" />
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Panel de ayuda para modo Familias -->
                    <Border Grid.Row="2"
                            Background="#DBEAFE"
                            BorderBrush="#3B82F6"
                            BorderThickness="1"
                            CornerRadius="6"
                            Padding="10"
                            Margin="0,0,0,8"
                            Visibility="{Binding IsFamiliesMode, Converter={StaticResource BoolToVisibility}}">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE946;" Foreground="#1E40AF" Margin="0,0,8,0" FontSize="16" />
                                <TextBlock Text="Modo Familias Activado" FontWeight="SemiBold" Foreground="#1E40AF" />
                            </StackPanel>
                            <TextBlock Text="Este modo está diseñado para sitios como Festo que organizan productos en familias con variantes. El scraper navegará a las páginas de familias y extraerá cada variante como un producto individual."
                                       TextWrapping="Wrap"
                                       Foreground="#1E3A8A"
                                       FontSize="12" />
                        </StackPanel>
                    </Border>
                    <Border Grid.Row="2"
                            Background="#FEF3C7"
                            BorderBrush="#F59E0B"
                            BorderThickness="1"
                            CornerRadius="6"
                            Padding="10"
                            Margin="0,0,0,8"
                            Visibility="{Binding NoSites, Converter={StaticResource BoolToVisibility}}">
                        <TextBlock Text="No hay proveedores cargados. Usa la pestaña 'Proveedores' para crear uno o revisa la conexión del backend."
                                   TextWrapping="Wrap"
                                   Foreground="#92400E" />
                    </Border>
                    <!-- Panel de estadísticas mejorado -->
                    <Border Grid.Row="3" Background="White" Padding="16" CornerRadius="6" BorderBrush="#E5E7EB" BorderThickness="1" Margin="0,0,0,12">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            
                            <!-- Encontrados -->
                            <Border Grid.Column="0" Background="#EFF6FF" Padding="12" CornerRadius="4" Margin="0,0,8,0">
                                <StackPanel>
                                    <TextBlock Text="Encontrados" FontSize="12" Foreground="#1E40AF" Margin="0,0,0,4" />
                                    <TextBlock Text="{Binding ScrapeResult.ProductsFound}" FontSize="24" FontWeight="Bold" Foreground="#1E3A8A" />
                                </StackPanel>
                            </Border>
                            
                            <!-- Creados -->
                            <Border Grid.Column="1" Background="#ECFDF5" Padding="12" CornerRadius="4" Margin="0,0,8,0">
                                <StackPanel>
                                    <TextBlock Text="Creados" FontSize="12" Foreground="#059669" Margin="0,0,0,4" />
                                    <TextBlock Text="{Binding ScrapeResult.ProductsCreated}" FontSize="24" FontWeight="Bold" Foreground="#047857" />
                                </StackPanel>
                            </Border>
                            
                            <!-- Actualizados -->
                            <Border Grid.Column="2" Background="#FEF3C7" Padding="12" CornerRadius="4" Margin="0,0,8,0">
                                <StackPanel>
                                    <TextBlock Text="Actualizados" FontSize="12" Foreground="#D97706" Margin="0,0,0,4" />
                                    <TextBlock Text="{Binding ScrapeResult.ProductsUpdated}" FontSize="24" FontWeight="Bold" Foreground="#B45309" />
                                </StackPanel>
                            </Border>
                            
                            <!-- Omitidos -->
                            <Border Grid.Column="3" Background="#F3F4F6" Padding="12" CornerRadius="4" Margin="0,0,8,0">
                                <StackPanel>
                                    <TextBlock Text="Omitidos" FontSize="12" Foreground="#6B7280" Margin="0,0,0,4" />
                                    <TextBlock Text="{Binding ScrapeResult.ProductsSkipped}" FontSize="24" FontWeight="Bold" Foreground="#4B5563" />
                                </StackPanel>
                            </Border>
                            
                            <!-- Duración -->
                            <Border Grid.Column="4" Background="#F5F3FF" Padding="12" CornerRadius="4">
                                <StackPanel>
                                    <TextBlock Text="Duración (ms)" FontSize="12" Foreground="#7C3AED" Margin="0,0,0,4" />
                                    <TextBlock Text="{Binding ScrapeResult.DurationMs}" FontSize="24" FontWeight="Bold" Foreground="#6D28D9" />
                                </StackPanel>
                            </Border>
                        </Grid>
                    </Border>
                    <Grid Grid.Row="5" Margin="0,0,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="3*" />
                            <ColumnDefinition Width="2*" />
                        </Grid.ColumnDefinitions>
                        <Border Grid.Column="0" Background="White" Padding="8" Margin="0,0,8,0" CornerRadius="6" BorderBrush="#E5E7EB" BorderThickness="1">
                            <DataGrid ItemsSource="{Binding StagingProducts}"
                                      SelectedItem="{Binding SelectedStagingProduct}"
                                      AutoGenerateColumns="True"
                                      IsReadOnly="False"
                                      CanUserAddRows="False" />
                        </Border>
                        <Border Grid.Column="1" Background="White" Padding="8" Margin="8,0,0,0" CornerRadius="6" BorderBrush="#E5E7EB" BorderThickness="1">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="140" />
                                </Grid.RowDefinitions>
                                <TextBlock Text="Traza reciente" FontWeight="SemiBold" Margin="0,0,0,8" />
                                <DataGrid Grid.Row="1"
                                          ItemsSource="{Binding RecentSyncLogs}"
                                          AutoGenerateColumns="False"
                                          IsReadOnly="True"
                                          CanUserAddRows="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="UTC" Binding="{Binding CreatedAt}" Width="120" />
                                        <DataGridTextColumn Header="Tipo" Binding="{Binding OperationType}" Width="100" />
                                        <DataGridTextColumn Header="Estado" Binding="{Binding Status}" Width="80" />
                                        <DataGridTextColumn Header="Mensaje" Binding="{Binding Message}" Width="*" />
                                    </DataGrid.Columns>
                                </DataGrid>
                                <TextBlock Grid.Row="2" Text="IA selectores" FontWeight="SemiBold" Margin="0,8,0,4" />
                                <TextBox Grid.Row="3"
                                         Text="{Binding SelectorAnalysisResult}"
                                         TextWrapping="Wrap"
                                         VerticalScrollBarVisibility="Auto"
                                         IsReadOnly="True"
                                         Background="#F9FAFB"
                                         BorderBrush="#E5E7EB"
                                         BorderThickness="1" />
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>
            </TabItem>

            <TabItem Header="SAE">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="Enviar seleccionado" Command="{Binding SendSelectedToSaeCommand}" Margin="0,0,8,0" />
                        <Button Content="Enviar pendientes" Command="{Binding SendPendingToSaeCommand}" Margin="0,0,8,0" />
                        <CheckBox Content="Programar envío"
                                  IsChecked="{Binding SaeScheduleEnabled}"
                                  Margin="12,0,8,0" />
                        <TextBlock Text="Cada (min):" VerticalAlignment="Center" />
                        <TextBox Text="{Binding SaeScheduleMinutes}" Width="60" Margin="6,0,0,0" />
                    </StackPanel>
                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding StagingProducts}"
                              SelectedItem="{Binding SelectedStagingProduct}"
                              AutoGenerateColumns="True"
                              IsReadOnly="False"
                              CanUserAddRows="False" />
                </Grid>
            </TabItem>
        </TabControl>

        <StatusBar Grid.Row="3" Background="#111827">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" Foreground="White" />
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
